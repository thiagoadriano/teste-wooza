var APPWZ;
(function (APPWZ) {
    appRun.$inject = [];
    function appRun() { }
    angular
        .module('AppWooza', ["ui.router"])
        .constant("API", "http://private-59658d-celulardireto2017.apiary-mock.com/")
        .run(appRun);
})(APPWZ || (APPWZ = {}));
var APPWZ;
(function (APPWZ) {
    Router.$inject = ["$stateProvider", "$urlRouterProvider", "$locationProvider"];
    function Router($stateProvider, $urlRouterProvider, $locationProvider) {
        var RoutesStates = [];
        RoutesStates.push({
            name: 'platforms',
            url: '/platforms',
            templateUrl: 'views/platforms.html',
            controller: 'PlatformsController',
            controllerAs: "vm"
        });
        RoutesStates.push({
            name: 'plans',
            url: '/planos/:idPlan',
            templateUrl: 'views/plans.html',
            controller: 'PlansController',
            controllerAs: "vm"
        });
        RoutesStates.push({
            name: 'register',
            url: '/register',
            templateUrl: 'views/register.html',
            controller: 'RegisterController',
            controllerAs: "vm"
        });
        RoutesStates.forEach(function (state) {
            $stateProvider.state(state);
        });
        $urlRouterProvider.otherwise("/platforms");
        //$locationProvider.html5Mode(true);
    }
    angular
        .module("AppWooza")
        .config(Router);
})(APPWZ || (APPWZ = {}));
/**
 * Classe construtora do componente de planos
 */
var APPWZ;
(function (APPWZ) {
    var objComp = {
        bindings: {
            list: "="
        },
        templateUrl: "../components/plans.html",
        controller: _controller
    };
    _controller.$inject = ["$state", "PlatformsModel"];
    function _controller($state, PM) {
        var vm = this;
        /**
         * Ação usada na seleção do plano para popular a model
         * @param item {Objeto} - Plano selecionado
         */
        vm.selectPlan = function (item) {
            PM.model.Plano = item;
            $state.go("register");
        };
    }
    angular.module("AppWooza")
        .component("plans", objComp);
})(APPWZ || (APPWZ = {}));
/**
 * Classe construtora do componente de produtos
 */
var APPWZ;
(function (APPWZ) {
    var objComp = {
        bindings: {
            list: "="
        },
        templateUrl: "../components/product.html",
        controller: _controller
    };
    _controller.$inject = ["$state", "PlatformsModel"];
    function _controller($state, PM) {
        var vm = this;
        /**
         * Ação usada na seleção da plataforma para popular a model
         * @param item {Objeto} - Plataforma selecionada
         */
        vm.selecionaPlataforma = function (item) {
            PM.model.Plataforma = item;
            $state.go("plans", { idPlan: item.sku });
        };
        vm.$postLink = function () {
            vm.plataforma = PM.model.Plataforma;
        };
    }
    angular.module("AppWooza")
        .component("products", objComp);
})(APPWZ || (APPWZ = {}));
/**
 * Controle da aplicação para a rota Plans
 */
var APPWZ;
(function (APPWZ) {
    PlansController.$inject = ["PlansService", "PlatformsModel", "$state"];
    function PlansController(PlS, PM, $state) {
        var vm = this;
        vm.listPlans = [];
        vm.Model = PM.model;
        init();
        /**
         * Executa inicialmente o controller
         */
        function init() {
            PlS.getPlans(vm.Model.Plataforma.sku).then(function (result) {
                vm.listPlans = result;
            });
            if (!vm.Model.Plataforma) {
                $state.go("platforms");
            }
        }
        ;
    }
    angular
        .module("AppWooza")
        .controller("PlansController", PlansController);
})(APPWZ || (APPWZ = {}));
/**
 * Controle da aplicação para a rota platforms
 */
var APPWZ;
(function (APPWZ) {
    PlatformsController.$inject = ["PlatformsService", "PlatformsModel", "UtilHelpers"];
    function PlatformsController(PS, PM, Util) {
        var vm = this;
        vm.listPlatforms = [];
        vm.listPlan = [];
        vm.Model = PM.model;
        vm.saveForm = saveForm;
        init();
        /**
         * Salva os dados do formulário e on envia para o serviço
         * @param isValid {boolean} - indica se os valores do formulário foram preenchidos
         */
        function saveForm(isValid) {
        }
        /**
         * Executa inicialmente o controller
         */
        function init() {
            PS.getPlatforms().then(function (result) {
                result.map(function (item) {
                    item.icone = Util.getIcon(item.nome);
                });
                vm.listPlatforms = result;
            });
        }
        ;
    }
    angular
        .module("AppWooza")
        .controller("PlatformsController", PlatformsController);
})(APPWZ || (APPWZ = {}));
/**
 * Recusro para mensagens de notificação sobre os fluxos para o usuário
 */
var APPWZ;
(function (APPWZ) {
    MsgInfos.$inject = [];
    function MsgInfos() {
        var box = $("main");
        return {
            success: _success,
            info: _info,
            warning: _warning,
            danger: _danger
        };
        function _geraEl(tipo, ico, msg) {
            return '<li><p class="alert alert-' + tipo + ' alert-dismissible">' +
                '<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>' +
                '<span class="glyphicon glyphicon-' + ico + '"></span> <strong>' + msg + '</strong>' +
                '</p></li>';
        }
        ;
        function _boxMsg() {
            return "<div class='alertSystem'><ul class='list-alert'></ul></div>";
        }
        function _success(msgInput) {
            _disparaAlert(_geraEl("success", "ok-sign", _checkMsg(msgInput)));
        }
        ;
        function _info(msgInput) {
            _disparaAlert(_geraEl("info", "info-sign", _checkMsg(msgInput)));
        }
        ;
        function _warning(msgInput) {
            _disparaAlert(_geraEl("warning", "alert", _checkMsg(msgInput)));
        }
        ;
        function _danger(msgInput) {
            _disparaAlert(_geraEl("danger", "remove-sign", _checkMsg(msgInput)));
        }
        ;
        function _disparaAlert(obj) {
            _removerAfterTime(_addAlert(obj));
        }
        ;
        function _checkMsg(msg) {
            if (typeof msg === "string") {
                if (msg.match(/^\[.*\]$/) !== null) {
                    return _isStringArray(msg);
                }
                else if (msg.match(/^\{.*\}$/) !== null) {
                    return _isStringObjeto(msg);
                }
            }
            else {
                if (angular.isArray(msg)) {
                    return msg.join("<br>");
                }
                else if (angular.isObject(msg)) {
                    return _isStringObjeto(JSON.stringify(msg));
                }
            }
            return msg;
        }
        ;
        function _isStringArray(msg) {
            var arr = JSON.parse(msg);
            return arr.join("<br>");
        }
        ;
        function _isStringObjeto(msg) {
            var arrayString = msg.replace(/^\{(.*)\}$/, "$1").split(',');
            return arrayString.join("<br>");
        }
        ;
        function _hasAlert() {
            return box.find(".alertSystem").is(":visible");
        }
        ;
        function _addAlert(obj) {
            var $tpl = $(obj).attr("id", Date.now()).hide();
            if (!_hasAlert()) {
                box.prepend(_boxMsg());
            }
            return box
                .find(".alertSystem .list-alert")
                .append($tpl)
                .find("li")
                .last()
                .fadeIn();
        }
        ;
        function _removerAfterTime(obj) {
            var id = obj.attr("id");
            var temporizer = setTimeout(function () {
                var alert = box.find(".alertSystem").find("#" + id);
                alert.fadeOut("slow", function () {
                    $(this).remove();
                    clearTimeout(temporizer);
                    removeAlertBox();
                });
            }, 6000);
        }
        ;
        function removeAlertBox() {
            if (!box.find(".alertSystem").find("li").length) {
                box.find(".alertSystem").empty().remove();
            }
        }
    }
    ;
    angular
        .module("AppWooza")
        .factory("MsgInfos", MsgInfos);
})(APPWZ || (APPWZ = {}));
/**
 * Funções que serão reaproveitadas durante a vida do app
 */
var APPWZ;
(function (APPWZ) {
    function UtilHelpers() {
        return {
            searchItemId: searchItemId,
            getIcon: getIcon
        };
        /**
         * Busca em uma lista o item pesquisado pela id.
         * Algoritmo usa divisão da lista para uma busca mais rápida
         * @param lista {Array} - Lista com todos os items
         * @param idItem {any} - id do item a ser buscado
         */
        function searchItemId(lista, idItem) {
            lista.sort(function (a, b) {
                return a.id > b.id;
            });
            var listaTamanho = lista.length, meioLista = Math.round(listaTamanho / 2), posiStart = idItem <= meioLista ? 0 : meioLista;
            for (var i = posiStart; i < idItem; i++) {
                if (lista[i].id === idItem) {
                    return lista[i];
                }
            }
            return null;
        }
        /**
         * Função retorna o icone para o tipo especificado
         * @param idclass classe de complementação para o icone
         */
        function getIcon(idclass) {
            var icon = {
                computador: "laptop",
                tablet: "tablet",
                wifi: "connection"
            };
            return icon[idclass.toLowerCase().replace(/\-/g, '')];
        }
    }
    angular
        .module("AppWooza")
        .factory("UtilHelpers", UtilHelpers);
})(APPWZ || (APPWZ = {}));
/**
 * Gera a model para o fluxo da plataforma
 */
var APPWZ;
(function (APPWZ) {
    function PlatformsModel() {
        var Model = {
            Plataforma: "",
            Plano: "",
            Nome: "",
            Email: "",
            Nascimento: "",
            CPF: "",
            Telefone: ""
        };
        /**
         * Limpa a model e cria nova referencia
         */
        function _newModel() {
            Model = {
                Plataforma: "",
                Plano: "",
                Nome: "",
                Email: "",
                Nascimento: "",
                CPF: "",
                Telefone: ""
            };
        }
        return {
            model: Model,
            newModel: _newModel
        };
    }
    angular
        .module("AppWooza")
        .factory("PlatformsModel", PlatformsModel);
})(APPWZ || (APPWZ = {}));
/**
 * Serviço para planos que linka o backend com o front end da aplicação
 */
var APPWZ;
(function (APPWZ) {
    PlansService.$inject = ["$http", "$q", "API", "MsgInfos"];
    function PlansService($http, $q, API, MsgInfos) {
        return {
            getPlans: _getPlans
        };
        /**
         * Busca os planos informados pela plataforma selecionada
         * @param plan {string} id da plataforma selecionada
         */
        function _getPlans(plan) {
            var defer = $q.defer();
            $http.get(API + "planos/" + plan)
                .then(function (result) {
                result.data.planos.filter(function (item) { return item.ativo; });
                defer.resolve(result.data.planos);
            })["catch"](function (err) {
                console.error(err);
                MsgInfos.danger("N\u00E3o foi poss\u00EDvel buscar os planos para a plataforma selecionada");
                defer.reject(err);
            });
            return defer.promise;
        }
    }
    angular
        .module("AppWooza")
        .service("PlansService", PlansService);
})(APPWZ || (APPWZ = {}));
/**
 * Serviços que linkando o backend com o front end da aplicação
 */
var APPWZ;
(function (APPWZ) {
    PlatformsService.$inject = ["$http", "$q", "API", "MsgInfos", "UtilHelpers"];
    function PlatformsService($http, $q, API, MsgInfos, Util) {
        return {
            getPlatforms: _getPlatforms
        };
        /**
         * Busca todas as platafomas e as devolve com promise
         */
        function _getPlatforms() {
            var defer = $q.defer();
            $http.get(API + "plataformas")
                .then(function (result) {
                result.data.plataformas.map(function (item) {
                    item.descricao = item.descricao.replace("|", "\n");
                });
                defer.resolve(result.data.plataformas);
            })["catch"](function (err) {
                console.error(err);
                MsgInfos.danger("Não foi possível mostrar as plataformas");
                defer.reject(err);
            });
            return defer.promise;
        }
    }
    angular
        .module("AppWooza")
        .service("PlatformsService", PlatformsService);
})(APPWZ || (APPWZ = {}));
/**
 * Serviço que conclui a aplicação
 */
var APPWZ;
(function (APPWZ) {
    RegisterController.$inject = ["$http", "$q", "API", "MsgInfos"];
    function RegisterController($http, $q, API, MsgInfos) {
        return {
            Salvar: _save
        };
        /**
         * Salva os dados do que foi selecionado e preenchido no fluxo da plataforma
         * @param obj {Object} Model da plataforma
         */
        function _save(obj) {
            console.log(obj);
            MsgInfos.success("Os dados foram enviados com sucesso!");
        }
    }
    angular
        .module("AppWooza")
        .service("RegisterController", RegisterController);
})(APPWZ || (APPWZ = {}));

//# sourceMappingURL=maps/app.min.js.map
